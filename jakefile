var paprika = require('./Build/node_modules/paprika'),
	msbuild = paprika.msbuild,
	path = require('path'),
	fs = require('fs'),
	config = {
		projectName: 'Facebook C# SDK',
		projectSafeName: 'FacebookCSharpSDK',
		version: fs.readFileSync('VERSION', 'utf-8'),
		paths: {
			root: path.normalize(__dirname)
		}
	};

console.log(config.projectName + ' v' + config.version);

msbuild.setDefaults({
	properties: { Configuration: 'Release' },
	processor: 'x86',
	version: 'net40'
});

task('default', ['build']);

namespace('build', function () {
	
	desc('Build .NET 4.0 binaries');
	task('net40', ['clean:net40', 'nuget:download'], function () {
		msbuild({
			file: 'Source/Facebook-Net40.sln',
			targets: ['Build']
		});
	});

	desc('Build .NET 3.5 binaries');
	task('net35', ['clean:net35', 'nuget:download'], function () {
		msbuild({
			file: 'Source/Facebook-Net35.sln',
			targets: ['Build']
		});
	});

	desc('Build Windows Phone 7.1 binaries');
	task('wp71', ['clean:wp71', 'nuget:download'], function () {
		msbuild({
			file: 'Source/Facebook-WP7.sln',
			targets: ['Build']
		})
	});

	desc('Build Silverlight 5 binaries');
	task('sl5', ['clean:sl5', 'nuget:download'], function () {
		msbuild({
			file: 'Source/Facebook-WP7.sln',
			targets: ['Build']
		});
	});

	task('all', ['build:net40', 'build:net35', 'build:wp71', 'build:sl5']);

});

task('build', ['build:all']);

namespace('clean', function () {
	
	task('net40', function () {
		msbuild({
			file: 'Source/Facebook-Net40.sln',
			targets: ['Clean']
		});
	});

	task('net35', function () {
		msbuild({
			file: 'Source/Facebook-Net35.sln',
			targets: ['Clean']
		});
	});

	task('wp71', function () {
		msbuild({
			file: 'Source/Facebook-WP7.sln',
			targets: ['Clean']
		});
	});

	task('sl5', function () {
		msbuild({
			file: 'Source/Facebook-SL5.sln',
			targets: ['Clean']
		});
	});

	task('all', ['clean:net40', 'clean:net35', 'clean:wp71', 'clean:sl5']);

});

task('clean', ['clean:all']);

namespace('nuget', function(){

	task('download', function () {
		msbuild({
			file: 'Source/.nuget/NuGet.targets',
			targets: ['CheckPrerequisites']
		});
	});

});
